import{r as a,j as e,H as I,a as D}from"./app-lLew-mq0.js";import{P as q}from"./public-layout-BG9J30RD.js";import{B as c}from"./button-DTZ67Z4b.js";import{c as S,d as R}from"./card-DWcOyhKP.js";import{I as B}from"./input-C9VfnsW_.js";import{L as O}from"./label-BTNSqOD-.js";import{A,b as L}from"./alert-CtEuE1ev.js";import{e as U,d as G,a as z,D as J,b as W,c as X}from"./dialog-ClflWXfj.js";import{A as Y}from"./arrow-left-Bw3DDjFc.js";import{S as _}from"./search-D9utk87M.js";import{F as $}from"./file-check-UDYRRxCK.js";import{U as M}from"./user-Bo55nJGb.js";import{G as Z,a as Q}from"./x-CV1yhBJZ.js";import{L as P}from"./lock-CHHvcVQn.js";import{C as K}from"./circle-check-big-Dc6Llj5D.js";import{D as ee}from"./download-CX4nki1j.js";import{C as se}from"./circle-alert-s6M2eRNP.js";/* empty css            */import"./sun-BER_QyYM.js";import"./external-link-1EEMm3Qs.js";import"./chevron-up-Bv-H0xE7.js";import"./phone-7sWFZgza.js";import"./mail-DnEJGpcS.js";import"./map-pin-DrOctKDV.js";import"./index-BzAksq8r.js";import"./index-BiNrCjIr.js";import"./index-CMRMG5Mo.js";import"./index-B9jue-Th.js";import"./index-CZQ422QV.js";import"./Combination-BEW_kzWa.js";import"./index-BOY9t191.js";import"./index-CxACbU5U.js";function Ve({records:d,searchQuery:f,recaptchaSiteKey:t}){const[r,j]=a.useState(null),[x,g]=a.useState(""),[y,N]=a.useState(!1),[w,i]=a.useState(""),[V,C]=a.useState(""),[E,b]=a.useState(!1),[u,l]=a.useState(""),[v,h]=a.useState(!1),m=a.useRef(null),o=a.useRef(null);a.useEffect(()=>{if(!t){h(!0),l("development-token");return}if(document.querySelector('script[src*="recaptcha/api.js"]'))h(!0);else{window.onRecaptchaVerifyLoad=()=>h(!0);const s=document.createElement("script");s.src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaVerifyLoad&render=explicit",s.async=!0,s.defer=!0,document.head.appendChild(s)}return()=>{window.onRecaptchaVerifyLoad=void 0}},[t]),a.useEffect(()=>{const s=window.grecaptcha;if(r&&v&&t&&m.current&&s){const p=setTimeout(()=>{if(m.current&&o.current===null)try{o.current=s.render(m.current,{sitekey:t,callback:n=>{l(n),i("")},"expired-callback":()=>{l(""),i("reCAPTCHA expired. Please verify again.")}})}catch(n){console.error("reCAPTCHA render error:",n)}},100);return()=>clearTimeout(p)}},[r,v,t]);const F=async s=>{if(s.preventDefault(),!!r){if(t&&!u){i("Please complete the reCAPTCHA verification.");return}N(!0),i("");try{const n=await(await fetch(`/admissions/transfer-certificate/${r.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({admission_number:x,recaptcha_token:u||"development-token"})})).json();if(n.success)b(!0),C(n.download_url);else{i(n.message||"Verification failed. Please try again.");const k=window.grecaptcha;k&&o.current!==null&&(k.reset(o.current),l(""))}}catch{i("An error occurred. Please try again.")}finally{N(!1)}}},H=s=>new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"long",year:"numeric"}),T=()=>{j(null),g(""),i(""),b(!1),C(""),l(""),o.current=null};return e.jsxs(q,{title:"Transfer Certificate Search Results",description:"Search results for Transfer Certificates",children:[e.jsx(I,{title:"TC Search Results"}),e.jsx("section",{className:"bg-gradient-to-b from-primary/10 to-white py-12",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(c,{variant:"ghost",className:"mb-4",onClick:()=>D.get("/admissions/transfer-certificate"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Search"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full",children:e.jsx(_,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Search Results"}),e.jsxs("p",{className:"text-gray-600",children:['Showing results for "',e.jsx("span",{className:"font-medium",children:f}),'"']})]})]})]})}),e.jsx("section",{className:"py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:d.length===0?e.jsx(S,{children:e.jsxs(R,{className:"py-12 text-center",children:[e.jsx($,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No Records Found"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:[`We couldn't find any Transfer Certificate matching "`,f,'". Please check the spelling or try a different name.']}),e.jsxs(c,{onClick:()=>D.get("/admissions/transfer-certificate"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Try Another Search"]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Found ",d.length," record(s). Click on a name to verify and download."]}),d.map(s=>e.jsx(S,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>j(s),children:e.jsx(R,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(M,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg",children:s.student_name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"S/o D/o:"}),s.father_name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),"Class ",s.class]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),H(s.date_of_issue)]})]})]})]}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Verify & Download"]})]})})},s.id))]})})})}),e.jsx(U,{open:!!r,onOpenChange:s=>!s&&T(),children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsxs(z,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Verify Your Identity"]}),e.jsx(W,{children:"Enter your admission number to verify and download the Transfer Certificate."})]}),E?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs(A,{className:"border-green-500 bg-green-50",children:[e.jsx(K,{className:"h-4 w-4 text-green-600"}),e.jsx(L,{className:"text-green-700",children:"Verification successful! Click below to download your TC."})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(c,{asChild:!0,className:"w-full",children:e.jsxs("a",{href:V,download:!0,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Download Transfer Certificate"]})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Link expires in 5 minutes"})]})]}):e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[r&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:r.student_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["TC #",r.tc_number," â€¢ Class ",r.class]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"admission_number",children:"Admission Number"}),e.jsx(B,{id:"admission_number",type:"text",value:x,onChange:s=>g(s.target.value),placeholder:"Enter your admission number",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is the unique number assigned at the time of admission."})]}),t&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{ref:m,className:"flex justify-center"})}),w&&e.jsxs(A,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(L,{children:w})]})]}),e.jsxs(X,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:T,children:"Cancel"}),e.jsx(c,{type:"submit",disabled:y||(t?!u:!1)||!x,children:y?"Verifying...":"Verify & Download"})]})]})]})})]})}export{Ve as default};
