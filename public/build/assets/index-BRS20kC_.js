import{r as a,j as e,H as q}from"./app-lLew-mq0.js";import{P as O}from"./public-layout-BG9J30RD.js";import{B as m}from"./button-DTZ67Z4b.js";import{c as L,d as R}from"./card-DWcOyhKP.js";import{I as A}from"./input-C9VfnsW_.js";import{L as U}from"./label-BTNSqOD-.js";import{A as z,b as B}from"./alert-CtEuE1ev.js";import{e as Y,d as G,a as Q,D as X,b as $,c as J}from"./dialog-ClflWXfj.js";import{F as V}from"./file-check-UDYRRxCK.js";import{S as W}from"./search-D9utk87M.js";import{X as P,G as M,a as Z,S as K}from"./x-CV1yhBJZ.js";import{U as ee}from"./user-Bo55nJGb.js";import{L as E}from"./lock-CHHvcVQn.js";import{C as se}from"./circle-check-big-Dc6Llj5D.js";import{D as ae}from"./download-CX4nki1j.js";/* empty css            */import"./sun-BER_QyYM.js";import"./external-link-1EEMm3Qs.js";import"./chevron-up-Bv-H0xE7.js";import"./phone-7sWFZgza.js";import"./mail-DnEJGpcS.js";import"./map-pin-DrOctKDV.js";import"./index-BzAksq8r.js";import"./index-BiNrCjIr.js";import"./index-CMRMG5Mo.js";import"./index-B9jue-Th.js";import"./index-CZQ422QV.js";import"./Combination-BEW_kzWa.js";import"./index-BOY9t191.js";import"./index-CxACbU5U.js";function Pe({records:x,recaptchaSiteKey:r}){const[n,y]=a.useState(""),[f,g]=a.useState(x),[t,N]=a.useState(null),[p,w]=a.useState(""),[b,v]=a.useState(!1),[C,c]=a.useState(""),[_,T]=a.useState(""),[F,S]=a.useState(!1),[j,o]=a.useState(""),[k,u]=a.useState(!1),h=a.useRef(null),d=a.useRef(null);a.useEffect(()=>{if(!r){u(!0),o("development-token");return}if(document.querySelector('script[src*="recaptcha/api.js"]'))window.grecaptcha?u(!0):window.onRecaptchaLoad=()=>u(!0);else{window.onRecaptchaLoad=()=>u(!0);const s=document.createElement("script");s.src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit",s.async=!0,s.defer=!0,document.head.appendChild(s)}return()=>{window.onRecaptchaLoad=void 0}},[r]),a.useEffect(()=>{if(t&&k&&r&&h.current&&window.grecaptcha){const s=setTimeout(()=>{if(h.current&&d.current===null)try{d.current=window.grecaptcha.render(h.current,{sitekey:r,callback:l=>{o(l),c("")},"expired-callback":()=>{o(""),c("reCAPTCHA expired. Please verify again.")}})}catch(l){console.error("reCAPTCHA render error:",l)}},100);return()=>clearTimeout(s)}},[t,k,r]),a.useEffect(()=>{if(!n.trim()){g(x);return}const s=n.toLowerCase(),l=x.filter(i=>i.student_name.toLowerCase().includes(s)||i.father_name.toLowerCase().includes(s)||i.class.toLowerCase().includes(s)||i.tc_number.toLowerCase().includes(s));g(l)},[n,x]);const H=async s=>{if(s.preventDefault(),!!t){if(r&&!j){c("Please complete the reCAPTCHA verification.");return}v(!0),c("");try{const i=await(await fetch(`/admissions/transfer-certificate/${t.id}/verify`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({admission_number:p,recaptcha_token:j||"development-token"})})).json();i.success?(S(!0),T(i.download_url)):(c(i.message||"Verification failed. Please try again."),window.grecaptcha&&d.current!==null&&(window.grecaptcha.reset(d.current),o("")))}catch{c("An error occurred. Please try again.")}finally{v(!1)}}},I=s=>new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"long",year:"numeric"}),D=()=>{N(null),w(""),c(""),S(!1),T(""),o(""),d.current=null};return e.jsxs(O,{title:"Transfer Certificate Verification",description:"Verify and download your Transfer Certificate from Army Public School Alwar",children:[e.jsx(q,{title:"Transfer Certificate Verification"}),e.jsx("section",{className:"bg-gradient-to-b from-primary/10 to-white py-12",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-primary/10 rounded-full mb-6",children:e.jsx(V,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Transfer Certificate Verification"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Search for your Transfer Certificate and download it securely"})]}),e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(A,{type:"text",placeholder:"Search by student name, father's name, class, or TC number...",value:n,onChange:s=>y(s.target.value),className:"pl-12 pr-4 py-6 text-lg"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2 text-center",children:[f.length," record(s) found"]})]})]})}),e.jsx("section",{className:"py-12",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:f.length===0?e.jsx(L,{children:e.jsxs(R,{className:"py-12 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No Records Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:n?`We couldn't find any Transfer Certificate matching "${n}". Please check the spelling or try a different search.`:"No Transfer Certificates are currently available."}),n&&e.jsxs(m,{onClick:()=>y(""),variant:"outline",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Clear Search"]})]})}):e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx(L,{className:"cursor-pointer hover:shadow-lg hover:border-primary/50 transition-all duration-200",onClick:()=>N(s),children:e.jsx(R,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full shrink-0",children:e.jsx(ee,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg truncate",children:s.student_name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-400",children:"S/o D/o:"}),e.jsx("span",{className:"truncate",children:s.father_name})]}),e.jsxs("span",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(M,{className:"h-3 w-3"}),"Class ",s.class]}),e.jsxs("span",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(Z,{className:"h-3 w-3"}),I(s.date_of_issue)]})]})]})]}),e.jsxs(m,{variant:"outline",size:"sm",className:"shrink-0 ml-4",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Verify"]})]})})},s.id))})})})}),e.jsx("section",{className:"py-8 bg-gray-50",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(K,{className:"h-5 w-5 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-1",children:"Secure Verification Process"}),e.jsx("p",{className:"text-sm text-gray-600",children:"To download your Transfer Certificate, you'll need to verify your identity by providing your admission number. This ensures that only authorized individuals can access the document."})]})]})})})}),e.jsx(Y,{open:!!t,onOpenChange:s=>!s&&D(),children:e.jsxs(G,{className:"sm:max-w-md",children:[e.jsxs(Q,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Verify Your Identity"]}),e.jsx($,{children:"Enter your admission number to verify and download the Transfer Certificate."})]}),F?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(se,{className:"h-10 w-10 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-green-900 mb-2",children:"Verification Successful!"}),e.jsx("p",{className:"text-sm text-green-700 mb-6",children:"Your identity has been verified. You can now download your Transfer Certificate."})]}),e.jsx(m,{asChild:!0,className:"w-full",size:"lg",children:e.jsxs("a",{href:_,download:!0,children:[e.jsx(ae,{className:"h-5 w-5 mr-2"}),"Download Transfer Certificate"]})}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Download link expires in 5 minutes"})]}):e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[t&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[e.jsx("p",{className:"font-medium",children:t.student_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["TC #",t.tc_number," â€¢ Class ",t.class]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"admission_number",children:"Admission Number *"}),e.jsx(A,{id:"admission_number",type:"text",value:p,onChange:s=>w(s.target.value),placeholder:"Enter your admission number",required:!0,autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"This is the unique number assigned at the time of admission."})]}),r&&e.jsx("div",{className:"space-y-2",children:e.jsx("div",{ref:h,className:"flex justify-center"})}),C&&e.jsx(z,{variant:"destructive",className:"border-red-500 bg-red-50",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(P,{className:"h-5 w-5 text-red-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-1",children:"Verification Failed"}),e.jsx(B,{className:"text-red-700",children:C})]})]})})]}),e.jsxs(J,{className:"gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:D,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:b||(r?!j:!1)||!p.trim(),children:b?"Verifying...":"Verify & Download"})]})]})]})})]})}export{Pe as default};
